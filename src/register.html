<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Register - Uqbar</title>
    <meta charset="utf-8" />
    <link rel="icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wAqhP/x////AP///wAqhP//KoT//////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/4xwJ////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////ACmE/7MqhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+N4hJ////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEPncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AK4X/zP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/9twjHf///wD///8A////AP///wD///8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/////AP///wD///8AKoT//////wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////ACqE//////8A////AP///wD///8A////ACqE//8qhP/D////AP///wD///8A/98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CCx////AP///wAqhP//////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//8qhP//////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP////8A////ACqE//////8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//yqE//8qhP//////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg/////wAqhP//KoT//////wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//KoT//yqE//8qhP///98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwfyyqE//8qhP//////AP///wAqhP//K4X/zP///wAqhP//////AP///wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//8qhP//KoT//yqE////3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/KoT//yqE//////8A////ACqE//8rhf/M////ACqE//////8A////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//yqE//8qhP//KoT////fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP8qhP//KoT//////wD///8AKoT//yuF/8z///8AKoT//////wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//KoT//yqE//8qhP//Lob7wPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg/yqE//8qhP//////AP///wAqhP//K4X/zP///wAqhP//////AP///wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//8qhP//KoT//yqE//8thvvL+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/KoT//yqE//////8A////ACqE//8rhf/M////ACqE//////8A////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//yqE//8qhP//KoT////fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP8qhP//KoT//////wD///8AKoT//yuF/8z///8AKoT//////wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//KoT//yqE//8qhP///98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg/yqE//8qhP//////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//8qhP//KoT//yqE////3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53B/7AKr/AyqE//////8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//yqE//8qhP//////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg/////wD///8AKoT//////wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//KoT//////wD///8A/98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/////AP///wAqhP//////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8AKoT/kf///wD///8A////AP///wD///8AKoT//yqE//////8A////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP7///8A////AP///wD///8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT/3SqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/////AP///wD///8A////AP///wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//rcIL3///8A////AP///wD///8A////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/////AP///wD///8A////AP///wD///8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wD///8A////ACuF/8z///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEPncIP/53CD/+dwg//ncIP////8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/3yAQ+dwg//ncIP/53CD/////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg9////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AAKr/AyqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//Z////mff/+Znx//mZ8P/pmfB/yZnwP8mZ8B/JmfAPyZnwDsm+cAbJ/jAGyf4QBMn+AADL/gAAy/4AAMv+AADL/gAAy/4AAMv+AADJ/gAAyf4QBsn+MAbJvnAHyZnwD8mZ8A/JmfAfyZnwP+mZ8H/5mfD/+Znx//+Z9///mf/8=">
    <meta httpEquiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1.00001, viewport-fit=cover" />
    <link href='https://fonts.googleapis.com/css?family=Press Start 2P' rel='stylesheet'>

    <style>
      :root {
        --uq-vlightpurple: #d9dcfc;
        --uq-lightpurple: #c7cafa;
        --uq-purple: #727bf2;
        --uq-darkpurple: #5761ef;
        --midnightpurp: #0a1170;
        --forgottenpurp: #45475e;
        --uq-lightpink: #f3ced2;
        --uq-pink: #dd7c8a;
        --uq-darkpink: #cd3c52;
        --blush: #d55d6f;
        --celeste: #adebe5;
        --lturq: #6bdbd0;
        --turq: #3acfc0;
        --celadon: #21897e;
        --deep-jungle: #14524c;
        --old-mint: #659792;
        --washed-gray: rgba(0, 0, 0, 0.03);
        --light-gray: rgba(0, 0, 0, 0.1);
        --medium-gray: rgba(0, 0, 0, 0.2);
        --dark-gray: rgba(0, 0, 0, 0.5);
        --charcoal: #333;
      }

      body {
        margin: 0;
        padding: 0;
        font-size: 16px;
        font-family: 'Press Start 2P';
        background-color: #027;
        color: white;
      }

      h1,h2,h3,h4,h5,h6 {
        line-height: 1.5em;
      }

      .col {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .row {
        display: flex;
        flex-direction: row;
        align-items: center;
      }

      input[type="text"], input[type="password"] {
        width: 100%;
        padding: 0.5em 0.75em;
        margin-bottom: 0.5em;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 1em;
      }

      button {
        width: 100%;
        padding: 1em;
        margin-bottom: 0.5em;
        border: 1px solid var(--uq-pink);
        border-radius: 4px;
        box-sizing: border-box;
        background-color: var(--uq-pink);
        cursor: pointer;
        font-size: 1em;
        transition: all .1s;
        box-shadow: 0 1px 2px var(--uq-darkpink);
        font-family: 'Press Start 2P';
        color: white;
        margin-top: 1em;
      }

      button:hover {
        background-color: var(--uq-darkpink);
        border: 1px solid var(--uq-darkpink);
      }

      #signup-page {
        width: 100%;
        height: 100%;
        flex: 1;
        display: flex;
        padding: 2em;
        max-width: calc(100vw - 4em);
      }

      label {
        font-size: 0.75em;
      }

      .label-row {
        margin: 0.5em 0;
        align-self: flex-start;
      }

      .tooltip-container {
        position: relative;
        display: inline-block;
        cursor: pointer;
      }

      .tooltip-button {
        border: 2px solid white;
        border-radius: 50%;
        height: 1em;
        width: 1em;
        text-align: center;
        font-size: 16px;
        line-height: 0.5em;
        margin-left: 0.5em;
      }

      .tooltip-content {
        visibility: hidden;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 0.5em;
        position: absolute;
        z-index: 1;
        top: 125%;
        left: 50%;
        margin-left: -60px;
        opacity: 0;
        transition: opacity 0.3s;
        font-family: sans-serif;
        line-height: 1.5em;
        min-width: 200px;
      }

      .tooltip-content::after {
        content: "";
        position: absolute;
        bottom: 100%;
        left: 30%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: transparent transparent #555 transparent;
      }

      .tooltip-container:hover .tooltip-content {
        visibility: visible;
        opacity: 1;
      }

      #signup-form {
        max-width: 420px;
      }

      #current-address {
        margin-left: 1em;
        font-family: 'Courier New', Courier, monospace;
        font-size: 1.25em;
        font-weight: 600;
      }

      #current-username {
        cursor: pointer;
        padding: 0.5em;
        border: 1px solid white;
        border-radius: 4px;
        margin: 1em 0;
      }

      #current-username {
        cursor: pointer;
        padding: 0.5em;
        border: 1px solid white;
        border-radius: 4px;
        margin: 1em 0;
      }

      #current-username:hover {
        border: 1px solid white;
        color: #027;
        background-color: white;
      }

      #connect-wallet {
        max-width: 420px;
      }

      #wallet-required-message {
        max-width: 500px;
        text-align: center;
        line-height: 1.5em;
      }

      #loader {
        display: inline-block;
        position: relative;
        width: 48px;
        height: 48px;
        margin-top: 16px;
      }
      #loader div {
        box-sizing: border-box;
        display: block;
        position: absolute;
        width: 36px;
        height: 36px;
        margin: 6px;
        border: 6px solid #fff;
        border-radius: 50%;
        animation: loader 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
        border-color: #fff transparent transparent transparent;
      }
      #loader div:nth-child(1) {
        animation-delay: -0.45s;
      }
      #loader div:nth-child(2) {
        animation-delay: -0.3s;
      }
      #loader div:nth-child(3) {
        animation-delay: -0.15s;
      }
      @keyframes loader {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div id="signup-page" class="col">
      <div id="signup-form-header" class="row" style="justify-content: center;">
        <img style="margin: 0 1em 0.2em 0;" src="data:image/vnd.microsoft.icon;base64,AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wAqhP/x////AP///wAqhP//KoT//////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/4xwJ////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////ACmE/7MqhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+N4hJ////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEPncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AK4X/zP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/9twjHf///wD///8A////AP///wD///8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/////AP///wD///8AKoT//////wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////ACqE//////8A////AP///wD///8A////ACqE//8qhP/D////AP///wD///8A/98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CCx////AP///wAqhP//////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//8qhP//////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP////8A////ACqE//////8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//yqE//8qhP//////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg/////wAqhP//KoT//////wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//KoT//yqE//8qhP///98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwfyyqE//8qhP//////AP///wAqhP//K4X/zP///wAqhP//////AP///wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//8qhP//KoT//yqE////3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/KoT//yqE//////8A////ACqE//8rhf/M////ACqE//////8A////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//yqE//8qhP//KoT////fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP8qhP//KoT//////wD///8AKoT//yuF/8z///8AKoT//////wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//KoT//yqE//8qhP//Lob7wPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg/yqE//8qhP//////AP///wAqhP//K4X/zP///wAqhP//////AP///wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//8qhP//KoT//yqE//8thvvL+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/KoT//yqE//////8A////ACqE//8rhf/M////ACqE//////8A////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//yqE//8qhP//KoT////fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP8qhP//KoT//////wD///8AKoT//yuF/8z///8AKoT//////wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//KoT//yqE//8qhP///98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg/yqE//8qhP//////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8A////AP///wD///8A////AP///wD///8AKoT//yqE//8qhP//KoT//yqE////3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53B/7AKr/AyqE//////8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//yqE//8qhP//////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg/////wD///8AKoT//////wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//KoT//////wD///8A/98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/////AP///wAqhP//////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8AKoT/kf///wD///8A////AP///wD///8AKoT//yqE//////8A////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/+dwg//ncIP7///8A////AP///wD///8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT/3SqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg//ncIP/53CD/////AP///wD///8A////AP///wD///8AKoT//yuF/8z///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEPncIP/53CD/+dwg//ncIP/53CD/+dwg//rcIL3///8A////AP///wD///8A////AP///wAqhP//K4X/zP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/3yAQ+dwg//ncIP/53CD/+dwg//ncIP/53CD/////AP///wD///8A////AP///wD///8A////ACqE//8rhf/M////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg//ncIP/53CD/+dwg/////wD///8A////AP///wD///8A////AP///wD///8A////ACuF/8z///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEPncIP/53CD/+dwg//ncIP////8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD/3yAQ+dwg//ncIP/53CD/////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8AKoT//yqE//////8A////AP///wD///8A////AP/fIBD53CD/+dwg9////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////ACqE//8qhP//////AP///wAqhP//KoT//////wD///8A////AP///wD///8A/98gEP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AAKr/AyqE//////8A////ACqE//8qhP//////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//Z////mff/+Znx//mZ8P/pmfB/yZnwP8mZ8B/JmfAPyZnwDsm+cAbJ/jAGyf4QBMn+AADL/gAAy/4AAMv+AADL/gAAy/4AAMv+AADJ/gAAyf4QBsn+MAbJvnAHyZnwD8mZ8A/JmfAfyZnwP+mZ8H/5mfD/+Znx//+Z9///mf/8=" />
        <h1 style="text-align: center;">Uqbar Setup</h1>
      </div>
      <button id="connect-wallet" onclick="connectWallet()" style="display: none;">Connect Browser Wallet</button>
      <p id="wallet-required-message" style="display: none;">You must have Metamask, Brave, or another browser-based Ethereum wallet to register.</p>
      <form id="signup-form" class="col" method="post" style="display: none;">
        <div class="row">
          <h4>Set up your Uqbar node with a .uq name</h4>
          <div class="tooltip-container">
            <div class="tooltip-button">&#8505;</div>
            <div class="tooltip-content">Uqbar nodes use a .uq name in order to identify themselves to other nodes in the network</div>
          </div>
        </div>
        <!-- <select name="nft-selector" value="none">
          <option value="none">None</option>
        </select> -->
        <!-- 0x5Af0D9827E0c53E4799BB226655A1de152A425a5 -->
        <!-- 8651 -->
        <!-- <div class="row label-row">
          <label for="nft-contract">NFT Contract Address</label>
          <div class="tooltip-container">
            <div class="tooltip-button">&#8505;</div>
            <div class="tooltip-content">The contract address of your NFT in hex format (ie "0x5Af0...2665")</div>
          </div>
        </div>
        <input autofocus type="text" required name="nft-contract" placeholder="Address" />
        <div class="row label-row">
          <label for="nft-contract">NFT ID</label>
        </div>
        <input type="text" required name="nft-id" placeholder="ID #" /> -->
        <div class="row" style="margin: 0 0 1em;">
          <div style="font-size: 0.75em;">Address:</div>
          <div id="current-address"></div>
        </div>
        <div class="row label-row" id="current-username-display" style="display: none;">
          <label for="nft-contract">Current Username:</label>
          <div id="current-username"></div>
        </div>
        <div class="row label-row">
          <label for="nft-contract">Uq Name</label>
        </div>
        <div class="row">
          <input type="text" required name="uq-name" placeholder="e.g. myname" onblur="checkUqName()" oninput="clearUqNameCheck()" />
          <div class="uq">.uq</div>
        </div>
        <div class="row label-row">
          <label for="password">New Password</label>
          <div class="tooltip-container">
            <div class="tooltip-button">&#8505;</div>
            <div class="tooltip-content">This password will be used to log in if you restart your node or switch browsers.</div>
          </div>
        </div>
        <input type="password" id="password" required minlength="6" name="password" placeholder="Min 6 characters" />
        <div class="row label-row">
          <label for="confirm-password">Confirm Password</label>
        </div>
        <input type="password" id="confirm-password" required minlength="6" name="confirm-password" placeholder="Min 6 characters" oninput="clearPasswordCheck()" />

        <label for="direct">Register as a direct node (only do this if you are hosting your node somewhere stable)</label>
        <input type="checkbox" id="direct" name="direct" />
        <button type="submit">Sign & Submit</button>
      </form>
      <div id="loading" class="col">
        <h3>Initiating node...</h3>
        <div id="loader"><div></div><div></div><div></div><div></div></div>
      </div>
    </div>
    <script>
      const UQBAR_NETWORK_URL = 'https://chain-id.uqbar.network/uqbar-chain-id'
      const UQBAR_EXPLORER_URL = `https://chain-id.uqbar.network/indexer`
      const UQBAR_NETWORK_HEX = '0x7261627175'
      const UQBAR_NETWORK_INT = 491260113269
      const CONNECTION_ERROR = 'There was an error connecting to your wallet. Please try again.'

      function formatAddress(address) {
        return `${address.slice(0, 6)}...${address.slice(-4)}`
      }

      async function loadWallet() {
        try {
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' })
          const networkId = String(await window.ethereum.request({ method: 'net_version' }).catch(() => '0x1'))

          if (networkId !== UQBAR_NETWORK_HEX && networkId !== UQBAR_NETWORK_INT) {
            // await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x5' }] });
            await window.ethereum.request({
              method: 'wallet_addEthereumChain',
              params: [{
                chainId: UQBAR_NETWORK_HEX,
                chainName: 'Uqbar',
                nativeCurrency: { name: 'ZIG', symbol: 'ZIG', decimals: 18 },
                rpcUrls: [UQBAR_NETWORK_URL],
                blockExplorerUrls: [UQBAR_EXPLORER_URL],
              }]
            })
          }

          return accounts[0]
        } catch (err) {
          console.error(err)
          throw new Error(err)
        }
      }

      async function checkAddress(address) {
        try {
          const usernameResponse = await fetch(`/check-address/${address}`)

          if (usernameResponse.status < 400) {
            const username = await usernameResponse.text()

            if (username) {
              document.getElementById('current-username-display').style.display = 'block'
              document.getElementById('current-username').innerText = username
              document.getElementById('current-username').addEventListener('click', () => {
                document.querySelector('input[name="uq-name"]').value = username
                document.getElementById('password')?.focus()
              })
            }
          }

        } catch (err) {}
      }

      function connectWallet() {
        loadWallet()
          .then((address) => {
            document.getElementById('connect-wallet').style.display = 'none'
            document.getElementById('signup-form').style.display = 'block'
            document.getElementById('current-address').innerText = formatAddress(address)
            checkAddress(address)
          })
          .catch((err) => {
            console.error(err)
            window.alert(CONNECTION_ERROR)
            window.location.reload()
          })
      }

      function clearPasswordCheck() {
        const input = document.getElementById('confirm-password');
        input.setCustomValidity('');
      }

      function clearUqNameCheck() {
        const input = document.querySelector('input[name="uq-name"]');
        input.setCustomValidity('');
      }

      function checkPassword() {
        const input = document.getElementById('confirm-password');
        const passwordsMatch = input.value === document.getElementById('password').value;
        if (passwordsMatch) {
          input.setCustomValidity('');
        } else {
          input.setCustomValidity('Passwords must match');
        }
        input.reportValidity();
        return passwordsMatch
      }

      async function checkUqName() {
        try {
          const input = document.querySelector('input[name="uq-name"]');
          const uqName = input.value;
          const validUqName = /^[a-z0-9-]+$/.test(uqName);
          if (!validUqName) {
            input.setCustomValidity('Uq names must be lowercase and alphanumeric');
            input.reportValidity();
            return false
          } else {
            const alreadyTaken = await fetch(`/check-username/${uqName}`)

            if (alreadyTaken.status === 409 && uqName !== document.getElementById('current-username').innerText) {
              input.setCustomValidity('Uq name already taken');
              input.reportValidity();
              return false
            } else {
              input.setCustomValidity('');
              input.reportValidity();
              return true
            }
          }
        } catch (err) {
          input.setCustomValidity('Uq name already taken');
          input.reportValidity();
          return false
        }
      }

      async function signAndSubmit(e) {
        e.preventDefault();
        e.stopPropagation();

        if (!checkPassword()) {
          return false
        }

        try {
          document.getElementById('loading').style.display = 'flex'
          document.getElementById('signup-form').style.display = 'none'
          const address = await loadWallet().catch(() => null)

          if (!address) {
            window.alert('Wallet connection failed. Please try again')
            document.getElementById('loading').style.display = 'none'
            document.getElementById('signup-form').style.display = 'flex'
            return false
          }

          // const nftContract = document.querySelector('input[name="nft-contract"]').value
          // const nftId = document.querySelector('input[name="nft-id"]').value
          const uqName = document.querySelector('input[name="uq-name"]').value
          const password = document.querySelector('input[name="password"]').value
          const direct = document.querySelector('input[name="direct"]').checked

          const message = await fetch('/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: uqName, password, address, direct })
          }).then((res) => res.text()).catch(() => null)

          if (!message) {
            window.alert('There was an error registering your uqname. Please try again')
            document.getElementById('loading').style.display = 'none'
            document.getElementById('signup-form').style.display = 'flex'
            return false
          }

          const signature = await ethereum.request({ method: 'personal_sign', params: [message, address, message] }).catch(() => null)

          if (!signature) {
            window.alert('There was an error signing the transaction. Please try again.')
            document.getElementById('loading').style.display = 'none'
            document.getElementById('signup-form').style.display = 'flex'
            return false
          }

          const registerResult = await fetch('/register', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(signature)
          })

          const httpServerPort = await registerResult.text()

          setTimeout(() => window.location.replace(`http://localhost:${httpServerPort}`), 10000)
        } catch (err) {
          console.error(err)
          window.alert(CONNECTION_ERROR)
          document.getElementById('loading').style.display = 'none'
          document.getElementById('signup-form').style.display = 'flex'
        } finally {
          return false
        }
      }

      const form = document.getElementById('signup-form')
      form.addEventListener('submit', signAndSubmit)

      document.addEventListener('DOMContentLoaded', () => {
        window.ethereum?.on('accountsChanged', function (accounts) {
          document.getElementById('current-address').innerText = formatAddress(accounts[0])
          checkAddress(accounts[0])
        })

        document.getElementById('loading').style.display = 'none'
        if (window.ethereum) {
          document.getElementById('connect-wallet').style.display = 'block'
        } else {
          document.getElementById('wallet-required-message').style.display = 'block'
        }
      })
    </script>
  </body>
</html>
